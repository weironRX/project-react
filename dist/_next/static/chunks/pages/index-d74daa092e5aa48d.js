(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(5386)}])},5386:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return A}});var n=t(5893),s=t(7294),i=t(9542),c=t.n(i),l=t(8948),r=t(3509),d=t(7837),_=t(6380),o=t.n(_),u=t(8803),h=t(5485),m=t(6203),g=t.n(m),x=e=>{let{handleChange:a}=e,{isLoading:t,isError:i,data:c}=(0,d.a)(["services"],async()=>u.m.getAll()),{isLoading:l,isError:r,data:_}=(0,d.a)(["clients"],async()=>h.y.getAll()),[o,m]=(0,s.useState)(""),[x,j]=(0,s.useState)(""),[p,v]=(0,s.useState)(""),[y,N]=(0,s.useState)(""),b=async()=>{a({alias:o,contact:x,service:p,price:y}),""!=p&&await u.m.create({name:p,price:y}),""!=o&&await h.y.create({alias:o,contact:x})};return(0,n.jsxs)("div",{className:g().container,children:[(0,n.jsxs)("div",{className:g().container__item,children:[(0,n.jsx)("p",{children:"Выбрать услугу"}),(0,n.jsxs)("select",{onChange:e=>{console.log(e);let a=null==c?void 0:c.data.find(a=>a.name==e.target.value);v(null==a?void 0:a.name),N(null==a?void 0:a.price)},children:[(0,n.jsx)("option",{disabled:!0,selected:!0,children:"Выбрать услугу"}),c&&c.data.map(e=>(0,n.jsx)("option",{value:e.name,children:e.name},e.name))]}),(0,n.jsxs)("div",{className:g().container__inputs,children:[(0,n.jsx)("input",{className:g().input,type:"text",value:p,onChange:e=>v(e.target.value)}),(0,n.jsx)("input",{className:g().input,type:"text",value:y,onChange:e=>N(e.target.value)})]})]}),(0,n.jsxs)("div",{className:g().container__item,children:[(0,n.jsx)("p",{children:"Выбрать клиента"}),(0,n.jsxs)("select",{onChange:e=>{let a=null==_?void 0:_.data.find(a=>a.alias==e.target.value);m(null==a?void 0:a.alias),j(null==a?void 0:a.contact)},children:[(0,n.jsx)("option",{disabled:!0,selected:!0,children:"Выбрать клиента"}),_&&_.data.map(e=>(0,n.jsx)("option",{value:e.alias,children:e.alias},e.alias))]}),(0,n.jsxs)("div",{className:g().container__inputs,children:[(0,n.jsx)("input",{className:g().input,type:"text",value:o,onChange:e=>m(e.target.value)}),(0,n.jsx)("input",{className:g().input,type:"text",value:x,onChange:e=>j(e.target.value)})]})]}),(0,n.jsx)("button",{className:g().save_button,onClick:()=>b(),children:"Выбрать"})]})},j=e=>{let{session:a,date:t,checked_hour:i}=e,[c,l]=(0,s.useState)(a),[_,u]=(0,s.useState)(!1);(0,s.useEffect)(()=>{l(a),""==c.hour&&l(e=>({...e,hour:i}))},[a]);let{isLoading:h,error:m,data:g}=(0,d.a)(["session",_],async()=>""!=c.alias?await r.m.create(t,c):{});return(0,n.jsxs)(s.Fragment,{children:[(0,n.jsxs)("tr",{className:o()[_?"item__changing":"item"],children:[(0,n.jsx)("th",{className:o().column,children:c.alias}),(0,n.jsx)("th",{children:c.contact}),(0,n.jsx)("th",{children:c.service}),(0,n.jsx)("th",{children:c.price}),(0,n.jsx)("th",{children:i}),(0,n.jsx)("th",{children:(0,n.jsx)("button",{className:o().change_button,onClick:()=>u(!_),children:_?"Сохранить":"Изменить"})})]}),(0,n.jsx)("tr",{children:_&&(0,n.jsx)(x,{handleChange:e=>{let{alias:a,contact:t,service:n,price:s}=e;l({...c,alias:a,contact:t,service:n,price:s})}})})]})};let p={id:0,hour:"",alias:"",contact:"",service:"",price:""},v=e=>e>=10?"".concat(e,":00"):"0".concat(e,":00"),y=()=>{let e=[];for(let a=0;a<24;a++)e.push(v(a));return e};t(1955);let N=()=>JSON.parse(localStorage.getItem("user")||"{}");var b=t(954),f=t.n(b),S=t(9420),E=t(9097);let w="change",B={getAll:async()=>await (0,S.Z)({url:"".concat(w),method:E.B.GET}),create:async e=>await (0,S.Z)({url:"".concat(w),method:E.B.POST,data:e})};var T=e=>{let{date:a,changeDate:t,remain:i}=e,[c,l]=(0,s.useState)(!1),[r,_]=(0,s.useState)(0),o=async()=>{l(!1),_(0),await B.create({date:a,length:String(r)});for(let e=1;e<100;e++)window.clearInterval(e)},{isLoading:u,error:h,data:m}=(0,d.a)(["change-all",a],async()=>B.getAll()),g=(0,s.useMemo)(()=>null==m?void 0:m.data.reduce((e,a)=>e+Number(a.length),0),[m,c]);return(0,n.jsxs)("aside",{className:f().aside,children:[(0,n.jsxs)("div",{className:f().aside__date,children:[(0,n.jsx)("input",{className:f().aside__input,onChange:t,type:"date"}),a]}),(0,n.jsxs)("nav",{className:f().aside__nav,children:[(0,n.jsx)("a",{className:f().aside__link,href:"clients",children:"Список клиентов"}),(0,n.jsx)("a",{className:f().aside__link,href:"services",children:"Услуги"}),(0,n.jsx)("a",{className:f().aside__link,href:"history",children:"История"})]}),(0,n.jsxs)("div",{className:f().aside__change,children:[(0,n.jsx)("button",{style:c?{pointerEvents:"none",backgroundColor:"blue"}:{},className:f().aside__change_button,onClick:()=>{l(!0),setInterval(()=>{_(e=>e+1)},1e3)},children:"Начать смену"}),(0,n.jsx)("button",{style:c?{}:{pointerEvents:"none",backgroundColor:"blue"},className:f().aside__change_button,onClick:o,children:"Завершить смену"}),(0,n.jsxs)("div",{className:f().aside__change_body,children:[(0,n.jsx)("div",{children:"Время смены:"}),c&&new Date(1e3*r).toISOString().slice(11,19),(0,n.jsx)("div",{children:"За месяц:"}),new Date(1e3*(g||0)).toISOString().slice(11,19)]}),(0,n.jsxs)("div",{className:f().aside__remain,children:[(0,n.jsx)("div",{children:"Осталось:"}),new Date(1e3*i).toISOString().slice(11,19)]})]})]})},k=()=>{let[e,a]=(0,s.useState)((0,l.B)(new Date)),[t,i]=(0,s.useState)(),[_,o]=(0,s.useState)(0),u=async e=>{a(e.target.value)},{isLoading:h,error:m,data:g}=(0,d.a)(["one-day",e],async()=>{let a=await r.m.getByDay(e);return i(a.data),a}),x=y(),v=N();return console.log(t),(0,s.useEffect)(()=>{o(0);let e=new Date().getHours(),a=new Date().getMinutes();for(let n=0;n<((null==t?void 0:t.length)||0);n++){let s=Number(t[n].hour[0]+t[n].hour[1]);s>e&&o((60-a)*60+3600*(s-e-1))}},[t,e]),console.log(_),(0,n.jsxs)("div",{className:c().wrapper,children:[(0,n.jsx)(T,{date:e,changeDate:u,remain:_}),(0,n.jsx)("main",{children:(0,n.jsxs)("table",{className:c().table,children:[(0,n.jsx)("thead",{className:c().table__header,children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{className:c().header_table__item,children:"ФИО/Псевдоним"}),(0,n.jsx)("th",{className:c().header_table__item,children:"Контакты"}),(0,n.jsx)("th",{className:c().header_table__item,children:"Виды услуг"}),(0,n.jsx)("th",{className:c().header_table__item,children:"Оплата"}),(0,n.jsx)("th",{className:c().header_table__item,children:"Время"}),(0,n.jsx)("th",{})]})}),(0,n.jsx)("tbody",{children:x.map(a=>t&&t.find(e=>e.hour==a)?(0,n.jsx)(j,{session:t.find(e=>e.hour==a),checked_hour:a,date:e},a):(0,n.jsx)(j,{session:p,checked_hour:a,date:e},a))})]})}),(0,n.jsx)("div",{className:c().name,children:v.name})]})};let C=()=>(0,n.jsx)(k,{});C.isOnlyUser=!0;var A=C},5485:function(e,a,t){"use strict";t.d(a,{y:function(){return c}});var n=t(9420),s=t(9097);let i="client",c={getAll:async()=>await (0,n.Z)({url:"".concat(i),method:s.B.GET}),getAllBySearch:async(e,a)=>await (0,n.Z)({url:"".concat(i,"/search"),method:s.B.GET,params:{alias:String(e),contact:a}}),getByName:async e=>(0,n.Z)({url:"".concat(i,"/").concat(e),method:s.B.GET}),create:async e=>(0,n.Z)({url:"".concat(i),method:s.B.POST,data:e}),update:async e=>(0,n.Z)({url:"".concat(i),method:s.B.PUT,data:e})}},9097:function(e,a,t){"use strict";var n,s;t.d(a,{B:function(){return n}}),(s=n||(n={})).GET="GET",s.POST="POST",s.PUT="PUT",s.PATCH="PATCH",s.DELETE="DELETE"},8803:function(e,a,t){"use strict";t.d(a,{m:function(){return c}});var n=t(9420),s=t(9097);let i="service",c={getAll:async()=>await (0,n.Z)({url:"".concat(i),method:s.B.GET}),getByName:async e=>(0,n.Z)({url:"".concat(i,"/").concat(e),method:s.B.GET}),create:async e=>(0,n.Z)({url:"".concat(i),method:s.B.POST,data:e}),update:async e=>(0,n.Z)({url:"".concat(i),method:s.B.PUT,data:e})}},3509:function(e,a,t){"use strict";t.d(a,{m:function(){return c}});var n=t(9420),s=t(9097);let i="session",c={getByDay:async e=>await (0,n.Z)({url:"".concat(i,"/").concat(e),method:s.B.GET}),getCompleted:async e=>(0,n.Z)({url:"".concat(i,"/completed/").concat(e),method:s.B.GET}),create:async(e,a)=>(0,n.Z)({url:"".concat(i,"/").concat(e),method:s.B.POST,data:a})}},8948:function(e,a,t){"use strict";function n(e){return e.toISOString().split("T")[0]}t.d(a,{B:function(){return n}})},9542:function(e){e.exports={wrapper:"Index_wrapper__QdjPq",table:"Index_table__KBjPW",header_table__item:"Index_header_table__item__Pz_tp",name:"Index_name__hZDcG"}},6203:function(e){e.exports={container:"SettingsBlock_container__9Ihqf",container__item:"SettingsBlock_container__item__KJxMP",container__inputs:"SettingsBlock_container__inputs__Z3IgE",input:"SettingsBlock_input__E0rdO",save_button:"SettingsBlock_save_button__JsHkR"}},954:function(e){e.exports={aside__change_body:"Aside_aside__change_body__vYuAl",aside:"Aside_aside__nbRCD",aside__date:"Aside_aside__date__d2Yyk",aside__input:"Aside_aside__input__uQMR5",aside__link:"Aside_aside__link__GjkZw",aside__nav:"Aside_aside__nav__UnhEd",aside__change:"Aside_aside__change__uXt6o",aside__change_button:"Aside_aside__change_button__zr3L_",aside__remain:"Aside_aside__remain__ViUME"}},6380:function(e){e.exports={item:"Item_item__eYQK_",item__changing:"Item_item__changing__G9_c9",change_button:"Item_change_button__O4_Gp"}}},function(e){e.O(0,[837,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);